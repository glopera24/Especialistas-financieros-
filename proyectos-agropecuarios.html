<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Asesoría para Proyectos Agropecuarios</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Definición de estilos reutilizables con Tailwind CSS */
        .input {
            @apply border border-gray-300 rounded-md p-2 w-full focus:outline-none focus:ring-2 focus:ring-green-500;
        }
    </style>
</head>
<body class="bg-gray-50 font-sans text-gray-800">

    <section class="bg-green-800 text-white py-16 px-6">
        <div class="max-w-4xl mx-auto text-center">
            <h1 class="text-4xl font-bold mb-4">¿Necesitas elaborar o mejorar tu proyecto productivo agropecuario?</h1>
            <p class="text-xl mb-6">Te ayudamos a estructurarlo, optimizarlo y dejarlo listo en PDF para presentarlo ante bancos, alcaldías o entidades de cooperación.</p>
            <p class="text-lg font-semibold">Solo completa el formulario y nosotros nos encargamos del resto.</p>
        </div>
    </section>

    <section class="max-w-5xl mx-auto py-10 px-6">
        <form action="/submit" method="POST" class="bg-white shadow-md rounded-lg p-8 space-y-8">

            <h2 class="text-2xl font-bold text-green-700">Formulario para la Elaboración de tu Proyecto</h2>

            <div>
                <h3 class="text-lg font-semibold text-green-700 mb-2">1. Datos del Productor</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <input type="text" name="nombre" placeholder="Nombre completo" class="input" required>
                    <input type="text" name="documento" placeholder="Documento de identidad" class="input" required>
                    <input type="email" name="correo" placeholder="Correo electrónico" class="input" required>
                    <input type="tel" name="telefono" placeholder="Teléfono de contacto" class="input" required>
                </div>
            </div>

            <div>
                <h3 class="text-lg font-semibold text-green-700 mb-2">2. Información del Predio</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <input type="text" name="ubicacion" placeholder="Ubicación del predio (vereda, municipio)" class="input" required>
                    <input type="text" name="area" placeholder="Área total (hectáreas)" class="input" required>
                    <select name="tenencia" class="input" required>
                        <option value="">Tipo de tenencia</option>
                        <option value="propio">Propio</option>
                        <option value="arrendado">Arrendado</option>
                        <option value="familiar">Familiar</option>
                    </select>
                    <input type="text" name="infraestructura" placeholder="Infraestructura existente (galpones, agua, etc.)" class="input">
                </div>
            </div>

            <div>
                <h3 class="text-lg font-semibold text-green-700 mb-2">3. Detalles del Proyecto</h3>
                <textarea id="descripcion" name="descripcion" rows="3" placeholder="¿Qué deseas producir? ¿Cuál es el objetivo del proyecto?" class="input w-full" required></textarea>
                <div class="mt-2 text-sm text-gray-600">
                    ¿No sabes cómo empezar? <button type="button" onclick="generarTextoIA('descripcion', 'respuestaDescripcion', 'Este proyecto busca producir [Tipo de producto] para alcanzar [Objetivo principal], enfocándose en [Aspectos clave o innovación].')" class="text-green-700 underline">💡 Generar con IA</button>
                </div>
                <div id="respuestaDescripcion" class="hidden mt-2 bg-green-50 border-l-4 border-green-600 p-3 text-sm text-green-800 rounded"></div>

                <textarea id="objetivos" name="objetivos" rows="2" placeholder="Objetivos específicos del proyecto" class="input w-full mt-4" required></textarea>
                <div class="mt-2 text-sm text-gray-600">
                    ¿Necesitas ayuda con los objetivos? <button type="button" onclick="generarTextoIA('objetivos', 'respuestaObjetivos', 'Los objetivos del proyecto son: 1. Aumentar la producción de [Producto] en un X%, 2. Mejorar la calidad de [Aspecto del producto], 3. Contribuir al desarrollo socioeconómico local mediante [Acciones].')" class="text-green-700 underline">💡 Generar con IA</button>
                </div>
                <div id="respuestaObjetivos" class="hidden mt-2 bg-green-50 border-l-4 border-green-600 p-3 text-sm text-green-800 rounded"></div>
            </div>

            <div>
                <h3 class="text-lg font-semibold text-green-700 mb-2">4. Proyección Financiera</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <input type="number" name="inversion" placeholder="Valor total estimado (COP)" class="input" required>
                    <input type="number" name="aporte" placeholder="Aporte propio (COP)" class="input" required>
                    <input type="number" name="financiado" placeholder="Valor solicitado a entidad (COP)" class="input">
                    <textarea name="proyeccion" rows="2" placeholder="Ingresos esperados por mes o por ciclo" class="input w-full mt-2"></textarea>
                </div>
            </div>

            <div class="mb-6">
                <h3 class="text-lg font-semibold text-green-700 mb-2">5. Impacto Esperado</h3>
                <textarea id="impacto" name="impacto" rows="4" placeholder="Describe el impacto esperado..." class="input" required></textarea>
                <div class="mt-2 text-sm text-gray-600">
                    ¿No sabes qué escribir? <button type="button" onclick="generarTextoIA('impacto', 'respuestaIA', 'El impacto esperado del proyecto es: generar [Número] empleos directos e indirectos, mejorar la economía local a través de [Mecanismo], promover prácticas agrícolas sostenibles, y contribuir a la seguridad alimentaria en la región.')" class="text-green-700 underline">💡 Generar con IA</button>
                </div>
                <div id="respuestaIA" class="hidden mt-2 bg-green-50 border-l-4 border-green-600 p-3 text-sm text-green-800 rounded"></div>
            </div>

            <div>
                <h3 class="text-lg font-semibold text-green-700 mb-2">6. Comercialización</h3>
                <textarea id="mercado" name="mercado" rows="3" placeholder="¿A quién piensa vender? ¿Tiene clientes potenciales?" class="input w-full" required></textarea>
                <div class="mt-2 text-sm text-gray-600">
                    ¿Necesitas una idea? <button type="button" onclick="generarTextoIA('mercado', 'respuestaMercado', 'El producto será comercializado a través de: mercados locales y campesinos, distribuidores mayoristas especializados, venta directa al consumidor en [Ubicación/Plataforma], y posible exportación a [País/Región].')" class="text-green-700 underline">💡 Generar con IA</button>
                </div>
                <div id="respuestaMercado" class="hidden mt-2 bg-green-50 border-l-4 border-green-600 p-3 text-sm text-green-800 rounded"></div>
            </div>

            <div>
                <h3 class="text-lg font-semibold text-green-700 mb-2">7. Documentos Adjuntos (opcional)</h3>
                <input type="file" name="adjuntos" multiple class="input w-full bg-white border">
            </div>

            <div class="text-center">
                <button type="submit" class="bg-green-700 text-white px-8 py-3 rounded-md font-semibold hover:bg-green-800">Enviar Información</button>
            </div>

        </form>
    </section>

    <script>
        // Función para aceptar una sugerencia de la IA y copiarla al textarea
        function aceptarSugerencia(textareaId, texto) {
            document.getElementById(textareaId).value = texto;
            const respuestaElement = document.getElementById(`respuesta${textareaId.charAt(0).toUpperCase() + textareaId.slice(1)}`);
            if (respuestaElement) {
                // Oculta la caja de sugerencia después de que se acepta el texto
                respuestaElement.classList.add('hidden');
            }
        }

        // Función asincrónica para generar texto utilizando la API de Hugging Face
        async function generarTextoIA(textareaId, respuestaId, promptBase) {
            const input = document.getElementById(textareaId).value || promptBase; // Usa el texto existente o un prompt base
            const resultado = document.getElementById(respuestaId);
            resultado.innerHTML = "Generando idea..."; // Mensaje de carga
            resultado.classList.remove('hidden'); // Muestra el contenedor de la respuesta

            // --- ADVERTENCIA DE SEGURIDAD CRÍTICA ---
            // ¡IMPORTANTE! Para un entorno de producción, NUNCA expongas tu API Key directamente
            // en el código del lado del cliente como aquí. Siempre debes manejar las llamadas a APIs
            // con claves sensibles a través de un servidor backend seguro.
            const HUGGING_FACE_API_KEY = "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"; // <-- TU API KEY AQUÍ

            try {
                const response = await fetch("https://api-inference.huggingface.co/models/gpt2", {
                    method: "POST",
                    headers: {
                        "Authorization": `Bearer ${HUGGING_FACE_API_KEY}`,
                        "Content-Type": "application/json"
                    },
                    body: JSON.stringify({ inputs: input })
                });

                const data = await response.json();
                if (data && data[0] && data[0].generated_text) {
                    const textoGenerado = data[0].generated_text.trim();
                    resultado.innerHTML = `
                        <p>${textoGenerado}</p>
                        <button type="button" onclick="aceptarSugerencia('${textareaId}', \`${textoGenerado.replace(/`/g, '\\`')}\`)" class="mt-2 bg-green-700 text-white px-3 py-1 rounded text-sm">✅ Usar esta sugerencia</button>
                        <button type="button" onclick="generarTextoIA('${textareaId}', '${respuestaId}', '${promptBase}')" class="mt-2 ml-2 bg-yellow-500 text-white px-3 py-1 rounded text-sm">🔄 Regenerar</button>
                    `;
                } else {
                    resultado.innerText = "No se pudo generar una respuesta. Intenta de nuevo.";
                }
            } catch (error) {
                console.error("Error al contactar la IA:", error);
                resultado.innerText = "Error al contactar la IA. Inténtalo más tarde.";
            }
        }
    </script>

</body>
</html>
