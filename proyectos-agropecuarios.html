<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Asesoría para Proyectos Agropecuarios</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Definición de estilos reutilizables con Tailwind CSS */
        .input {
            @apply border border-gray-300 rounded-md p-2 w-full focus:outline-none focus:ring-2 focus:ring-green-500;
        }
    </style>
</head>
<body class="bg-gray-50 font-sans text-gray-800">

    <section class="bg-green-800 text-white py-16 px-6">
        <div class="max-w-4xl mx-auto text-center">
            <h1 class="text-4xl font-bold mb-4">¿Necesitas elaborar o mejorar tu proyecto productivo agropecuario?</h1>
            <p class="text-xl mb-6">Te ayudamos a estructurarlo, optimizarlo y dejarlo listo en PDF para presentarlo ante bancos, alcaldías o entidades de cooperación.</p>
            <p class="text-lg font-semibold">Solo completa el formulario y nosotros nos encargamos del resto.</p>
        </div>
    </section>

    <section class="max-w-5xl mx-auto py-10 px-6">
        <form action="https://formspree.io/f/myzppnrz" method="POST" class="bg-white shadow-md rounded-lg p-8 space-y-8">

            <h2 class="text-2xl font-bold text-green-700">Formulario para la Elaboración de tu Proyecto</h2>

            <div>
                <h3 class="text-lg font-semibold text-green-700 mb-2">1. Datos del Productor</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <input type="text" name="nombre" placeholder="Nombre completo" class="input" required>
                    <input type="text" name="documento" placeholder="Documento de identidad" class="input" required>
                    <input type="email" name="correo" placeholder="Correo electrónico" class="input" required>
                    <input type="tel" name="telefono" placeholder="Teléfono de contacto" class="input" required>
                </div>
            </div>

            <div>
                <h3 class="text-lg font-semibold text-green-700 mb-2">2. Información del Predio</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <input type="text" name="ubicacion" placeholder="Ubicación del predio (vereda, municipio)" class="input" required>
                    <input type="text" name="area" placeholder="Área total (hectáreas)" class="input" required>
                    <select name="tenencia" class="input" required>
                        <option value="">Tipo de tenencia</option>
                        <option value="propio">Propio</option>
                        <option value="arrendado">Arrendado</option>
                        <option value="familiar">Familiar</option>
                    </select>
                    <textarea id="infraestructura" name="infraestructura" rows="2" placeholder="Infraestructura existente (galpones, agua, etc.)" class="input"></textarea>
                    <div class="mt-2 text-sm text-gray-600 col-span-full">
                        ¿Qué infraestructura tienes? <button type="button" onclick="generarTextoIA('infraestructura', 'respuestaInfraestructura', 'Ejemplos de infraestructura existente en el predio: Galpones, establos, sistemas de riego por goteo, pozos profundos, cercas perimetrales, bodegas de almacenamiento, electrificación rural.')" class="text-green-700 underline">💡 Generar con IA</button>
                    </div>
                    <div id="respuestaInfraestructura" class="hidden mt-2 bg-green-50 border-l-4 border-green-600 p-3 text-sm text-green-800 rounded col-span-full"></div>
                </div>
            </div>

            <div>
                <h3 class="text-lg font-semibold text-green-700 mb-2">3. Detalles del Proyecto</h3>
                <textarea id="descripcion" name="descripcion" rows="3" placeholder="¿Qué deseas producir? ¿Cuál es el objetivo del proyecto?" class="input w-full" required></textarea>
                <div class="mt-2 text-sm text-gray-600">
                    ¿No sabes cómo empezar? <button type="button" onclick="generarTextoIA('descripcion', 'respuestaDescripcion', 'Describe en detalle el proyecto productivo que deseas implementar. ¿Qué tipo de cultivo o animal planeas producir? ¿Cuál es la escala esperada? Por ejemplo: "Este proyecto busca establecer una granja avícola de [X] gallinas ponedoras para la producción de [Y] huevos diarios, con el objetivo de abastecer el mercado local y generar ingresos sostenibles."')" class="text-green-700 underline">💡 Generar con IA</button>
                </div>
                <div id="respuestaDescripcion" class="hidden mt-2 bg-green-50 border-l-4 border-green-600 p-3 text-sm text-green-800 rounded"></div>

                <textarea id="objetivos" name="objetivos" rows="2" placeholder="Objetivos específicos del proyecto" class="input w-full mt-4" required></textarea>
                <div class="mt-2 text-sm text-gray-600">
                    ¿Necesitas ayuda con los objetivos? <button type="button" onclick="generarTextoIA('objetivos', 'respuestaObjetivos', 'Define los objetivos específicos y medibles de tu proyecto. ¿Qué quieres lograr en términos de producción, eficiencia, impacto social o ambiental? Por ejemplo: "Los objetivos del proyecto son: 1. Alcanzar una producción de [X] toneladas/litros/unidades de [Producto] en el primer año. 2. Reducir los costos de producción en un [Y]% mediante la implementación de nuevas tecnologías. 3. Generar [Z] empleos directos para la comunidad local."')" class="text-green-700 underline">💡 Generar con IA</button>
                </div>
                <div id="respuestaObjetivos" class="hidden mt-2 bg-green-50 border-l-4 border-green-600 p-3 text-sm text-green-800 rounded"></div>
            </div>

            <div>
                <h3 class="text-lg font-semibold text-green-700 mb-2">4. Proyección Financiera</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <input type="number" id="inversion" name="inversion" placeholder="Valor total estimado (COP)" class="input" required>
                    <div class="mt-2 text-sm text-gray-600 col-span-full">
                        ¿Estimación de inversión? <button type="button" onclick="generarTextoIA('inversion', 'respuestaInversion', 'Considera los costos de terreno, semillas/animales, infraestructura, maquinaria, mano de obra, insumos, permisos. Una inversión total estimada podría ser de COP 150.000.000.')" class="text-green-700 underline">💡 Generar con IA</button>
                    </div>
                    <div id="respuestaInversion" class="hidden mt-2 bg-green-50 border-l-4 border-green-600 p-3 text-sm text-green-800 rounded col-span-full"></div>

                    <input type="number" id="aporte" name="aporte" placeholder="Aporte propio (COP)" class="input" required>
                    <div class="mt-2 text-sm text-gray-600 col-span-full">
                        ¿Cuánto aportas tú? <button type="button" onclick="generarTextoIA('aporte', 'respuestaAporte', 'Tu aporte propio puede incluir efectivo, terrenos, maquinaria existente, o mano de obra valorada. Un aporte propio podría ser de COP 50.000.000.')" class="text-green-700 underline">💡 Generar con IA</button>
                    </div>
                    <div id="respuestaAporte" class="hidden mt-2 bg-green-50 border-l-4 border-green-600 p-3 text-sm text-green-800 rounded col-span-full"></div>

                    <input type="number" id="financiado" name="financiado" placeholder="Valor solicitado a entidad (COP)" class="input">
                    <div class="mt-2 text-sm text-gray-600 col-span-full">
                        ¿Cuánto necesitas prestado? <button type="button" onclick="generarTextoIA('financiado', 'respuestaFinanciado', 'El valor solicitado a la entidad financiera debe ser la diferencia entre la inversión total y tu aporte propio. Por ejemplo, si la inversión total es COP 150.000.000 y tu aporte es COP 50.000.000, solicitarías COP 100.000.000.')" class="text-green-700 underline">💡 Generar con IA</button>
                    </div>
                    <div id="respuestaFinanciado" class="hidden mt-2 bg-green-50 border-l-4 border-green-600 p-3 text-sm text-green-800 rounded col-span-full"></div>

                    <textarea id="proyeccion" name="proyeccion" rows="2" placeholder="Ingresos esperados por mes o por ciclo" class="input w-full mt-2"></textarea>
                    <div class="mt-2 text-sm text-gray-600 col-span-full">
                        ¿Cómo proyectas tus ingresos? <button type="button" onclick="generarTextoIA('proyeccion', 'respuestaProyeccion', 'Proyecta los ingresos esperados de tu proyecto. ¿Cuánto producto se venderá y a qué precio? Por ejemplo: "Se proyectan ingresos mensuales de COP [X] por la venta de [Y] unidades de [Producto], con un crecimiento anual del [Z]%."')" class="text-green-700 underline">💡 Generar con IA</button>
                    </div>
                    <div id="respuestaProyeccion" class="hidden mt-2 bg-green-50 border-l-4 border-green-600 p-3 text-sm text-green-800 rounded col-span-full"></div>
                </div>
            </div>

            <div class="mb-6">
                <h3 class="text-lg font-semibold text-green-700 mb-2">5. Impacto Esperado</h3>
                <textarea id="impacto" name="impacto" rows="4" placeholder="Describe el impacto esperado..." class="input" required></textarea>
                <div class="mt-2 text-sm text-gray-600">
                    ¿No sabes qué escribir? <button type="button" onclick="generarTextoIA('impacto', 'respuestaIA', 'Describe el impacto positivo que tu proyecto tendrá en la comunidad, el medio ambiente y la economía local. Por ejemplo: "El proyecto generará [X] empleos directos e indirectos, contribuirá a la seguridad alimentaria de la región, implementará prácticas agrícolas sostenibles como [ejemplo], y fortalecerá la economía rural."')" class="text-green-700 underline">💡 Generar con IA</button>
                </div>
                <div id="respuestaIA" class="hidden mt-2 bg-green-50 border-l-4 border-green-600 p-3 text-sm text-green-800 rounded"></div>
            </div>

            <div>
                <h3 class="text-lg font-semibold text-green-700 mb-2">6. Comercialización</h3>
                <textarea id="mercado" name="mercado" rows="3" placeholder="¿A quién piensa vender? ¿Tiene clientes potenciales?" class="input w-full" required></textarea>
                <div class="mt-2 text-sm text-gray-600">
                    ¿Necesitas una idea? <button type="button" onclick="generarTextoIA('mercado', 'respuestaMercado', 'Describe tu estrategia de comercialización. ¿Quiénes son tus clientes objetivo? ¿Cómo vas a llegar a ellos? ¿Existen acuerdos de compra ya establecidos? Por ejemplo: "El producto será comercializado a través de mercados campesinos locales, acuerdos con supermercados regionales, y venta directa a restaurantes. Ya contamos con cartas de intención de compra de [X] clientes potenciales."')" class="text-green-700 underline">💡 Generar con IA</button>
                </div>
                <div id="respuestaMercado" class="hidden mt-2 bg-green-50 border-l-4 border-green-600 p-3 text-sm text-green-800 rounded"></div>
            </div>

            <div>
                <h3 class="text-lg font-semibold text-green-700 mb-2">7. Documentos Adjuntos (opcional)</h3>
                <input type="file" name="adjuntos" multiple class="input w-full bg-white border">
            </div>

            <div class="text-center">
                <button type="submit" class="bg-green-700 text-white px-8 py-3 rounded-md font-semibold hover:bg-green-800">Enviar Información</button>
            </div>

        </form>
    </section>

    <script>
        // Función para aceptar una sugerencia de la IA y copiarla al textarea o input numérico
        function aceptarSugerencia(inputId, texto) {
            const inputField = document.getElementById(inputId);
            if (!inputField) return;

            // Si es un campo numérico, intenta limpiar el texto para que sea un número
            if (inputField.type === 'number') {
                const cleanedText = texto.replace(/[^\d.]/g, ''); // Permite solo dígitos y puntos decimales
                inputField.value = parseFloat(cleanedText) || ''; // Convierte a número o vacío si no es válido
            } else {
                // Para campos de texto (textarea)
                inputField.value = texto;
            }

            const respuestaElement = document.getElementById(`respuesta${inputId.charAt(0).toUpperCase() + inputId.slice(1)}`);
            if (respuestaElement) {
                respuestaElement.classList.add('hidden'); // Oculta la sugerencia después de ser aceptada
            }
        }

        // Función asincrónica para generar texto utilizando la API de Hugging Face
        async function generarTextoIA(inputId, respuestaId, promptBase) {
            const inputElement = document.getElementById(inputId);
            const currentInput = inputElement.value;
            // Combina el prompt base con el texto actual del campo para un contexto más rico
            const prompt = currentInput ? `Basado en lo siguiente: "${currentInput}", genera un texto más detallado sobre: ${promptBase}.` : promptBase;
            const resultado = document.getElementById(respuestaId);
            resultado.innerHTML = "Generando sugerencia..."; // Mensaje de carga
            resultado.classList.remove('hidden');

            // --- ADVERTENCIA DE SEGURIDAD CRÍTICA ---
            // ¡IMPORTANTE! Para un entorno de producción, NUNCA expongas tu API Key directamente
            // en el código del lado del cliente como aquí. Siempre debes manejar las llamadas a APIs
            // con claves sensibles a través de un servidor backend seguro.
            const HUGGING_FACE_API_KEY = "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"; // <-- TU API KEY AQUÍ

            // Modelo de IA más capaz (puedes probar otros si este no cumple tus expectativas)
            const MODEL_NAME = "distilbert/distilgpt2"; 

            try {
                const response = await fetch(`https://api-inference.huggingface.co/models/${MODEL_NAME}`, {
                    method: "POST",
                    headers: {
                        "Authorization": `Bearer ${HUGGING_FACE_API_KEY}`,
                        "Content-Type": "application/json"
                    },
                    body: JSON.stringify({ 
                        inputs: prompt,
                        parameters: { max_new_tokens: 150, temperature: 0.7, repetition_penalty: 1.2 } // Ajusta estos parámetros
                    })
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.error || `Error HTTP: ${response.status}`);
                }

                const data = await response.json();
                if (data && data[0] && data[0].generated_text) {
                    let textoGenerado = data[0].generated_text.trim();
                    // Limpia el texto generado para eliminar el prompt original si se incluyó
                    if (textoGenerado.startsWith(prompt)) {
                        textoGenerado = textoGenerado.substring(prompt.length).trim();
                    }
                    // Quita saltos de línea y espacios extras al inicio/final
                    textoGenerado = textoGenerado.replace(/^\s*\n\s*|\s*\n\s*$/g, '');

                    resultado.innerHTML = `
                        <p>${textoGenerado}</p>
                        <button type="button" onclick="aceptarSugerencia('${inputId}', \`${textoGenerado.replace(/`/g, '\\`')}\`)" class="mt-2 bg-green-700 text-white px-3 py-1 rounded text-sm">✅ Usar esta sugerencia</button>
                        <button type="button" onclick="generarTextoIA('${inputId}', '${respuestaId}', '${promptBase}')" class="mt-2 ml-2 bg-yellow-500 text-white px-3 py-1 rounded text-sm">🔄 Regenerar</button>
                    `;
                } else {
                    resultado.innerText = "No se pudo generar una sugerencia. Por favor, intenta de nuevo o proporciona más contexto.";
                }
            } catch (error) {
                console.error("Error al contactar la IA:", error);
                resultado.innerText = `Error al contactar la IA: ${error.message}. Verifica tu API Key o intenta más tarde.`;
            }
        }
    </script>

</body>
</html>
